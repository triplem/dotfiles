# -*- eval: (and (fboundp 'gptel-mode) (gptel-mode 1)); -*-
:PROPERTIES:
:GPTEL_MODEL: claude-sonnet-4-20250514
:GPTEL_BACKEND: Claude
:GPTEL_SYSTEM: You are a large language model working in Emacs and a helpful assistant. Respond concisely using org-mode syntax.\n\nWhen writing Python code, use this template:\n\n#+BEGIN_SRC jupyter-python\n<python-code>\n#+END_SRC\n
:GPTEL_BOUNDS: ((response (1095 5112)))
:END:
* org-db v3

The goal in this project is to make a new org-db package that consolidates the functionality from:

- [[./../org-db.el]]
- [[../org-db-fulltext.el]]
- [[../org-db-agenda.el]]
- [[../org-db-images.el]]
- [[../org-db-audio.el]]

into a new elisp and python package. The python package will implement a FastAPI server as a front end to libsql to enable full text and semantic search, as well as searching images and audio. The elisp package will provide interactive commands to do the searching that can be accessed conveniently from a transient menu.

Review the files in those links and summarize in an organized way the features that are currently part of org-db.

Based on the provided code, here's an organized summary of org-db's current features:

* org-db v3 - Current Feature Summary

** Core Database Architecture

*** *Database Management*
- SQLite-based storage with foreign key constraints
- Automatic database setup and table creation
- File MD5 checksums for change detection
- Queue-based processing during Emacs idle time
- Incremental updates when files are saved

*** *Data Models*
- *Files*: Tracks org files with metadata and timestamps
- *Headlines*: Org headings with TODO states, priorities, tags, properties
- *Links*: All org-mode links with types, paths, descriptions
- *Properties*: Key-value pairs from org headings
- *Keywords*: File-level keywords (#+TITLE, #+AUTHOR, etc.)
- *Tags*: Heading tags with many-to-many relationships
- *Timestamps*: Scheduled/deadline dates and standalone timestamps

** Search and Discovery Features

*** *Content Search*
- *Headlines*: Find headings by title, TODO state, tags, priority
- *Properties*: Search by property names and values
- *Links*: Browse and navigate to links across all files
- *Source Blocks*: Search code blocks by language and content
- *Keywords*: Find files by keyword values

*** *Pattern-Based Search*
- *Hashtags* (=#tag=): Custom tagging system with regex matching
- *@-labels* (=@person=): People/entity references
- *Email addresses*: Automatic extraction and search
- *Targets*: Org radio targets and link destinations

*** *Specialized Views*
- *Contacts*: Headings with EMAIL properties
- *Locations*: Headings with ADDRESS properties
- *Bookmarks*: Headings with URL properties
- *Recent files*: Files sorted by last modification

** Extended Functionality Modules

*** *Full-Text Search* (=org-db-fulltext.el=)
- FTS5 virtual table for content search
- Dynamic candidate completion
- Snippet-based results with context
- Project-scoped search capability

*** *Agenda System* (=org-db-agenda.el=)
- Alternative to org-agenda for large file collections
- Deadline and scheduled item tracking
- Calendar visualization with color coding
- Bulk operations (mark done, archive, ignore)
- Integration with standard org-agenda

*** *Image Search* (=org-db-images.el=)
- OCR text extraction using Tesseract
- Image thumbnail previews in search results
- Text search within image content
- Support for PNG/JPG files

*** *Audio/Video Search* (=org-db-audio.el=)
- Speech-to-text transcription
- Audio/video file content indexing
- Integration with SEM (Scimax Editmarks)
- Support for AIFF and MOV files

** User Interface and Navigation

*** *Interactive Commands*
- =org-db-headings=: Main headline browser
- =org-db-contacts=: Contact management
- =org-db-locations=: Location/address search
- =org-db-hashtags=: Tag-based navigation
- =org-db-@=: People/entity search
- =org-db-links=: Link browser
- =org-db-files=: File browser
- =org-db-agenda=: Task/deadline management

*** *Integration Features*
- Ivy/Counsel completion interface
- Multi-action support for bulk operations
- Transformer functions for enhanced display
- Backlink discovery
- org-id link resolution override
- Hydra menu for quick access

** Maintenance and Utilities

*** *Database Management*
- File change detection and auto-updates
- Queue processing for background updates
- Database cleaning (remove missing files)
- Complete database reset
- Index entire directories recursively
- Project-based indexing

*** *Performance Optimizations*
- Idle-time processing to avoid blocking
- MD5-based change detection
- Configurable ignore patterns for files/properties
- Separate databases for different content types

** Configuration Options

*** *Customizable Settings*
- Database location and naming
- Update function pipeline
- File ignore patterns
- Tag/property exclusions
- Keyword filtering
- Debug logging

This architecture provides a comprehensive alternative to org-agenda that scales well with thousands of org files while maintaining rich search and discovery capabilities across multiple content types.


* New features

** replace sqlite with libsql

Use similar table structures, but update them for new functionality

** semantic vector search

Add a table that stores chunks, line positions and embeddings for each document for vector search

** async on the Emacs side

I don't want Emacs to be blocked while indexing since that will be done on the Python server side

** CLIP image search

store clip embeddings to search images by description
